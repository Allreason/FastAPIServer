<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Untitled Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        .sql {
            font-family:  Geneva, Verdana, sans-serif;
            padding: 10px;
        }

        textarea {
            border: 1px solid #DADADA;
            color: rgba(0, 0, 0, 0.82);
            height: 200px;
            margin-bottom: 20px;
            outline: 0 none;
            padding: 3px 1px 3px 5px;
            width: 100%;
            font-size: 16px;
            font-family: Tahoma, sans-serif;
            line-height: normal;
            box-shadow: inset 0px 1px 4px #ECECEC;
            -moz-box-shadow: inset 0px 1px 4px #ECECEC;
            -webkit-box-shadow: inset 0px 1px 4px #ECECEC;

        }

        .container {

            width: 100%;
            align-content: center;
            justify-content: center;
            display: flex;
            padding: 0 5px;
            box-sizing: border-box;

        }

        .container>div {
            width: 50%;
            padding: 5px;
        }


        .substitute,
        .append {
            height: 40px;
            width: 100%;
            background-color: #33b3e5;
            outline: 0 none;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }
        .substitute {

            background-color: #ff0808;

        }
        
    </style>
</head>

<body>


<div id="results">
    {% if not out %}
        <p>Content is Null</p>
    {% else %}
        <button id="goup">Go Up</button>
        {% if out[0].drive %}
        <h1>On Drive: {{out[0].drive}}</h1>
        {% else %}
        <h1>All Contents</h1>
        {% endif %}
        {% for i in out %}
            {% if i.filename %}
                {% if i.attributes  == 'D'%}
                    <p>
                        <button class="path" style="color:rgba(0, 0, 255);font-size:17px;margin:4px" location="{{i.location}}" drive="{{i.drive}}" id="{{i.filename}}">{{i.filename}}</button>
                    </p>
                {% else %}
                    <p>
                        <p class="path" style="color:rgba(0, 0, 0);font-size:17px;margin:4px" location="{{i.location}}" drive="{{i.drive}}" id="{{i.filename}}">{{i.filename}}</button>
                    </p>
                {% endif %}
            {% else %}
                <p>
                <button class="path" style="color:rgba(0, 0, 255, 0.47);font-size:17px;margin:4px" location="root" drive="" id="{{i}}">{{i}}</button>
                </p>
            {% endif %}
        {% endfor %}
    {% endif %}
</div>

</body>
<script src="{{ url_for('script', path='jquery-3.6.0.min.js') }}"></script>
<script>
    jQuery(':button').click(function () {
        if(this.id === "goup"){

            reg = /.*ckn\/?(\?fullpathstr64=)?/
            const pathstr64=window.location.href.replace(reg,'')
            if(pathstr64===""){
                return
            }
            const pathstr = window.decodeURIComponent(atob(pathstr64))
            reg2 = /[^\/]+\/?$/
            const fullpath = pathstr.replace(reg2,'')
            if(fullpath===""){
                location.replace('http://114.132.248.40:8877/ckn')
                return
            }
            location.replace('http://114.132.248.40:8877/ckn/?fullpathstr64='+btoa(fullpath))
            return
        }

        const link_name = this.id
        const parentfolder = $(this).attr('location')
        const drive = $(this).attr('drive')

        console.log(link_name)
        if(drive === ""){
            var fullpath = btoa(window.encodeURIComponent(link_name+":/"))
        }else{
            console.log("elsefirst")
            if(parentfolder===""){
                console.log("p is null")
                var fullpath = btoa(window.encodeURIComponent(drive+":/"+link_name))
            }else{
                var fullpath = btoa(window.encodeURIComponent(drive+":/"+parentfolder+"/"+link_name))
            }
        }
        console.log(parentfolder,fullpath)
        location.replace('http://114.132.248.40:8877/ckn/?fullpathstr64='+fullpath)
        
    });


</script>

</html>