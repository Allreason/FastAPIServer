<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Untitled Document</title>
    <style>
        @font-face {
            font-family: 'iconfont';  /* Project id 3166118 */
            src: url('//at.alicdn.com/t/c/font_3166118_84irum3l2m4.woff2?t=1669367234624') format('woff2'),
                 url('//at.alicdn.com/t/c/font_3166118_84irum3l2m4.woff?t=1669367234624') format('woff'),
                 url('//at.alicdn.com/t/c/font_3166118_84irum3l2m4.ttf?t=1669367234624') format('truetype');
          }
        .iconfont{
            font-family:"iconfont" !important;
            font-size:16px;font-style:normal;
            -webkit-font-smoothing: antialiased;
            -webkit-text-stroke-width: 0.2px;
            -moz-osx-font-smoothing: grayscale;
            
            
        }
        * {
            margin: 0;
            padding: 0;
        }

        .sql {
            font-family:  Geneva, Verdana, sans-serif;
            padding: 10px;
        }

        /*textarea {
            border: 1px solid #DADADA;
            color: rgba(0, 0, 0, 0.82);
            height: 20px;
            margin-bottom: 0px;
            outline: 0 none;
            padding: 1px 1px 1px 5px;
            width: 50%;
            font-size: 16px;
            font-family: Tahoma, sans-serif;
            line-height: normal;
            box-shadow: inset 0px 1px 4px #ECECEC;
            -moz-box-shadow: inset 0px 1px 4px #ECECEC;
            -webkit-box-shadow: inset 0px 1px 4px #ECECEC;

        }*/ 

        .container {

            width: 100%;
            align-content: center;
            justify-content: center;
            display: flex;
            padding: 0 5px;
            box-sizing: border-box;

        }

        .container>div {
            /*width: 50%;*/
            margin:13px;
            padding: 0px;
        }


        .substitute,
        .append {
            height: 40px;
            width: 100%;
            background-color: #33b3e5;
            outline: 0 none;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }
        .substitute {

            background-color: #ff0808;

        }
        
    </style>
</head>

<body>


<div id="results">
    <div class="container">
        <button style="color:rgb(0, 119, 255);font-size:17px;margin:10px;border:none;background:transparent;border-bottom:solid 0.5px;" id="gohome">Go üè†</button>
        <button style="color:rgb(0, 119, 255);font-size:17px;margin:10px;border:none;background:transparent;border-bottom:solid 0.5px;" id="goup">Go ‚Üë</button>
        <div>
            <textarea id="searchcontent" placeholder="" rows="1"></textarea>
        </div>
        <button class="search" style="color:rgb(0, 119, 255);font-size:17px;margin:10px;border:none;background:transparent;border-bottom:solid 0.5px;" id="skip">
            Search
        </button>
    </div>

    {% if not out %}
        <p class="container">Content is Null</p>
    {% else %}
        {% if out[0].drive %}
        <h1  class="container">{{out[0].drive}}:/{{out[0].location}}</h1>
        {% else %}
        <h1 class="container">All Drives</h1>
        {% endif %}
        {% for i in out %}
            {% if i.filename %}
                {% if i.attributes  == 'D'%}
                    <p>
                        <button class="path" style="color:rgba(0, 0, 255);font-size:17px;margin:6px;border:none;background:transparent" location="{{i.location}}" drive="{{i.drive}}" id="{{i.filename}}"><i class="iconfont">&#xe671;</i> {{i.filename}}</button>
                        
                    </p>
                {% else %}
                    <p>
                        <p class="path" style="color:rgba(0, 0, 0);font-size:17px;margin:6px;font-family:Arial, Helvetica, sans-serif" location="{{i.location}}" drive="{{i.drive}}" id="{{i.filename}}"><i class="iconfont">&#xe672;</i> {{i.filename}}</button>
                    </p>
                {% endif %}
            {% else %}
                <p>
                <button class="path" style="color:rgba(0, 0, 255);font-size:17px;margin:4px;border:none;background:transparent" location="root" drive="" id="{{i}}"><i class="iconfont">&#xe8a8;</i> {{i}}</button>
                </p>
            {% endif %}
        {% endfor %}
    {% endif %}
</div>

</body>
<script src="{{ url_for('script', path='jquery-3.6.0.min.js') }}"></script>
<script>
    $('.search').click(() => {
        const message = $('#searchcontent').val()
        if (!message) return
        $.post('http://114.132.248.40:8877/postform/', { text: message, type: 'search' }, function (result) {
            console.log('data', result)
           
        })
    });
    jQuery(':button').click(function () {
        if(this.id==='skip'){
            return
        }
        if(this.id==="gohome"){
            location.replace('http://114.132.248.40:8877/ckn')
            return
        }
        if(this.id === "goup"){

            reg = /.*ckn\/?(\?fullpathstr64=)?/
            const pathstr64=window.location.href.replace(reg,'')
            if(pathstr64===""){
                return
            }
            const pathstr = window.decodeURIComponent(atob(pathstr64))
            reg2 = /[^\/]+\/?$/
            const fullpath = pathstr.replace(reg2,'')
            if(fullpath===""){
                location.replace('http://114.132.248.40:8877/ckn')
                return
            }
            location.replace('http://114.132.248.40:8877/ckn/?fullpathstr64='+btoa(window.encodeURIComponent(fullpath)))
            return
        }

        const link_name = this.id
        const parentfolder = $(this).attr('location')
        const drive = $(this).attr('drive')

        console.log(link_name)
        if(drive === ""){
            var fullpath = btoa(window.encodeURIComponent(link_name+":/"))
        }else{
            console.log("elsefirst")
            if(parentfolder===""){
                console.log("p is null")
                var fullpath = btoa(window.encodeURIComponent(drive+":/"+link_name))
            }else{
                var fullpath = btoa(window.encodeURIComponent(drive+":/"+parentfolder+"/"+link_name))
            }
        }
        console.log(parentfolder,fullpath)
        location.replace('http://114.132.248.40:8877/ckn/?fullpathstr64='+fullpath)
        
    });


</script>

</html>